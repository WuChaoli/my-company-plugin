# 工作流程规范

## 核心原则

**系统化的工作流程是高质量交付的保障**

---

## 绝对禁令

| 禁令 | 反例 | 正例 |
|------|------|------|
| **禁止串行执行独立任务** | 先 agent 1，后 agent 2 | 并行启动多个 agents |
| **禁止跳过 SKILL 检查** | 收到任务立即执行 | 任务前先检查并调用 SKILL |
| **禁止测试前编写代码** | 先写功能，再补测试 | TDD：RED → GREEN → REFACTOR |
| **禁止无根因修复** | "试一下改这个" | systematic-debugging：先调查根因 |
| **禁止主分支直接开发** | 在 main/master 直接编码 | 创建 worktree 隔离环境 |
| **禁止跳过验证** | "应该可以了" | 运行实际命令验证 |

---

## Agent 编排

### 并行执行强制要求

**必须** 对独立操作使用并行 Task 执行：

```markdown
# ✓ 正确
Launch 3 agents in parallel:
1. Security analysis
2. Performance review
3. Type checking

# ✗ 错误
First agent 1, then agent 2, then agent 3
```

### 优先使用Agent

我们的时间和预算都非常珍贵，尽可能多使用Agents进行代理工作，如非必要都不要亲自上手工作
你有一群非常得力的手下，他们非常能干，你需要发挥战略和指挥的优势帮助他们刚好得完成任务

---

## SKILL 调用规范

### 核心原则

**SKILL 调用是前提条件，非可选项**

### 1% 规则

- [ ] **触发条件**：存在 1% 可能性需要 SKILL，必须调用
- [ ] **无例外**："简单问题" 也要检查
- [ ] **调用优先**：在提供任何响应之前

### 调用流程

```
收到任务 → 检查相关 SKILL（1%规则）→ Skill 工具调用 → 严格遵循步骤 → 响应用户
```

---

## 执行流程

### 批次执行模式

- [ ] **默认批次大小**：3 个任务
- [ ] **批次内**：标记 in_progress → 执行 → 标记 completed
- [ ] **批次间**：报告实现 + 验证输出 + "Ready for feedback"
- [ ] **收到反馈**：应用更改 → 执行下一批次

### 遇到阻塞

- [ ] **立即停止**：不要猜测
- [ ] **阻塞场景**：
  - 缺少依赖
  - 测试失败
  - 指令不清
  - 验证反复失败

---

## TodoWrite 最佳实践

用途：
- 跟踪多步骤任务进度
- 验证对指令的理解
- 启用实时调整

Todo 揭示问题：
- 步骤顺序错误
- 缺失/多余项
- 错误粒度
- 误解需求

---

## 验证清单

### 任务开始前

- [ ] 检查任务关键词
- [ ] 判断是否存在 1% 可能性需要 SKILL
- [ ] 如是，使用 Skill 工具调用
- [ ] 读取 SKILL 返回内容
- [ ] 判断 SKILL 是否适用
- [ ] 如适用，严格遵循步骤

---

## 常见错误认知

| 错误认知 | 真相 |
|---------|------|
| "Issue 太简单，不需要流程" | 简单问题也有根因，流程对简单问题更快 |
| "紧急情况，没时间流程" | 系统化调试比随机尝试更快 |
| "先试一下，以后再调查" | 首次修复设定模式，从一开始就做对 |
| "测试后写也一样" | 测试后写=验证行为，测试前写=定义行为 |

---

**规范版本**: 1.0
**最后更新**: 2026-02-05
**变更**: 整合 top-rules.md 和 development-workflow-rules.md
