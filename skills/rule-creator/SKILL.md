---
name: rule-creator
description: 创建面向AI的行为规范和工作流程规则。用于定义：1) AI行为规范（如禁止/必须规则、边界约束）2) SKILL/AGENT调用流程（何时触发、调用顺序、决策逻辑）3) 通用工作流规范。当用户提到"创建规范"、"定义规则"、"行为约束"、"调用流程"、"工作流规范"或需要为SKILL/AGENT定义触发条件和执行流程时使用此技能。
---

# Rule Creator

## 核心原则

1. **相信AI理解能力** - 简洁精准，无需冗余解释
2. **宪法式语言** - 使用"禁止"、"必须"、"应该"等约束性词汇
3. **清单格式** - 每条规则独立，易于扫描和遵守
4. **可验证** - 每条规则应可检查、可测试

## 规范结构

```
规范名称.md
├── # 规范名称
├── ## 核心原则（可选，提供上下文）
├── ## 绝对禁令（禁止事项）
├── ## 必须遵守（必须事项）
├── ## 推荐做法（应该事项）
└── ## 验证清单（检查项）
```

## 语言规范

### 约束性词汇

| 级别 | 词汇 | 用途 |
|------|------|------|
| **最高** | 禁止 | 绝不可为的行为 |
| **高** | 必须 | 强制要求 |
| **中** | 应该 | 推荐做法 |
| **低** | 可以 | 可选行为 |

### 规则模式

```markdown
## 绝对禁令

| 禁令 | 反例 | 正例 |
|------|------|------|
| **禁止联想** | 用户问API → 主动补充"您可能还需要鉴权" | 仅回答API问题 |
| **禁止自省** | "让我想想...这个方案可能有问题..." | 直接给出确定答案或询问 |

## 必须遵守

- [ ] 每个函数必须有类型签名
- [ ] 所有外部调用必须有超时设置
```

## 规范类型

### 1. AI行为规范

定义AI助手的行为边界和约束。

```markdown
# 行为边界规则

## 核心原则
**仅响应用户显式指令，拒绝隐式推测与过度延伸**

## 绝对禁令
- **禁止联想** - 不主动延伸用户问题
- **禁止自省** - 不展示思考过程
- **禁止兜底** - 失败后不自动尝试替代方案

## 必须遵守
- 指令不明确时必须暂停询问
- 多种实现路径时必须由用户选择

## 验证清单
- [ ] 无联想式延伸
- [ ] 无自省式表述
- [ ] 确认前无自动兜底
```

### 2. SKILL/AGENT调用流程

定义何时触发、如何调用、决策逻辑。

```markdown
# SKILL调用规范

## 核心原则
**精准触发，避免过度调用**

## 调用条件

| SKILL | 触发关键词 | 触发场景 |
|-------|-----------|----------|
| tdd-workflow | "新功能"、"修复bug" | 编码任务 |
| serena-mcp | "符号"、"重构" | 代码分析 |

## 调用顺序
1. 检查触发关键词 → 2. 确认上下文匹配 → 3. 执行SKILL → 4. 验证结果

## 禁止模式
- 禁止为简单任务调用复杂SKILL
- 禁止串行调用可并行的SKILL
```

### 3. 工作流规范

定义多步骤流程的执行规则。

```markdown
# 开发工作流

## 流程步骤
1. 需求确认 → 2. 设计方案 → 3. 编码实现 → 4. 测试验证

## 检查点
- **步骤1→2**: 必须有用户确认
- **步骤2→3**: 必须通过设计评审
- **步骤3→4**: 测试覆盖率≥80%

## 禁止跳过
- 不可跳过需求确认
- 不可跳过测试验证
```

## 编写流程

### 步骤1: 明确规范目的

确定规范类型：
- **行为规范** - 约束AI行为
- **流程规范** - 定义调用顺序
- **混合规范** - 行为+流程

### 步骤2: 提取规则清单

使用AskUserQuestion收集场景：
```markdown
- 哪些行为必须禁止？
- 哪些行为必须执行？
- 何时触发/调用？
- 如何验证遵守情况？
```

### 步骤3: 编写规则

按照"语言规范"编写：
- 使用表格对比正反例
- 使用清单列举规则
- 保持每条规则≤20字

### 步骤4: 添加验证

为每条规则设计检查方式：
```markdown
## 验证脚本
```bash
# scripts/validate_rule.sh
grep -r "禁止联想" docs/ || echo "❌ 缺少联想禁令"
```

## 常见模板

### 行为约束模板

```markdown
# [规范名称]

## 核心原则
**[一句话原则]**

## 绝对禁令

| 禁令 | 反例 | 正例 |
|------|------|------|
| **[禁令名称]** | [错误行为] | [正确行为] |

## 必须遵守

- [ ] [必须项1]
- [ ] [必须项2]

## 验证清单

- [ ] [检查项1]
- [ ] [检查项2]
```

### 调用流程模板

```markdown
# [SKILL/AGENT调用规范]

## 核心原则
**[调用原则]**

## 触发条件

| SKILL/AGENT | 触发关键词 | 触发场景 |
|-------------|-----------|----------|
| [名称] | [关键词] | [场景描述] |

## 调用顺序

1. [步骤1] → 2. [步骤2] → 3. [步骤3]

## 决策逻辑

```
if [条件1]:
    → [路径1]
elif [条件2]:
    → [路径2]
```

## 禁止模式

- 禁止[不当行为1]
- 禁止[不当行为2]
```

## 资源

### scripts/validate_rule.py

验证规则文件的完整性和质量。

```python
import sys
import re
from pathlib import Path

def validate_rule(file_path):
    """验证规则文件结构"""
    with open(file_path) as f:
        content = f.read()

    errors = []

    # 检查必需章节
    if "## 绝对禁令" not in content and "## 必须遵守" not in content:
        errors.append("缺少约束性章节")

    # 检查约束性词汇
    constraints = re.findall(r'\*\*(禁止|必须|应该)\*\*', content)
    if not constraints:
        errors.append("缺少约束性词汇")

    # 检查表格格式
    if '|' in content and not re.search(r'\|.*\|.*\|.*\|', content):
        errors.append("表格格式错误")

    return errors
```

## 最佳实践

1. **规则粒度** - 每条规则只约束一个行为
2. **可测试性** - 每条规则应能通过自动化检查
3. **版本管理** - 规范变更需记录版本历史
4. **定期评审** - 根据实际使用情况迭代优化
